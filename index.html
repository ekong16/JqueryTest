<html>
<head>
    <meta charset="utf-8">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="viewport" content="width=device-width, 
    user-scalable=no, initial-scale=1, maximum-scale=1, user-scalable=0" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
    <title>Test</title>
    <link rel="stylesheet" href="styles.css"/>
</head>

<body>
    <script src="jquery.js"></script>
    
    <script type="text/javascript">
        /*TODO: Figure out how to get mobile version to be so that you cant hold it indefinitely.
        */
        var CANVAS_WIDTH = window.innerWidth;
        var CANVAS_HEIGHT = window.innerHeight;

        var canvasElement = $("<canvas width='" + CANVAS_WIDTH + 
                              "' height='" + CANVAS_HEIGHT + "'></canvas>");
        
        var canvas = canvasElement.get(0).getContext("2d");
        canvasElement.appendTo('body');
        var textX = 100;
        var textY = 100;
        var FPS = 60;
        
        var right = false;
        var up = false;
        var left = false;
        var down = false;
        var jumped = false;
        var charSize = canvas.canvas.height*0.1;
       
        
        //Check if computer or mobile. Adds relevent event listeners --keyboard or touch. 
        if( /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
            window.addEventListener('orientationchange', resizeCanvas, false);
            window.addEventListener('load', function(){ 
                window.scrollTo(0,50); });
            window.addEventListener('touchstart', function(e){
                e.preventDefault();
                if (!jumped){
                    up = true;
                    jumped = true;
                } else{up = false;}
            }, false);
            
            window.addEventListener('touchend', function(e){
                e.preventDefault();
                up = false; jumped = false;
            }, false);
            
            window.addEventListener('touchmove', function(e){
                e.preventDefault();
            },false);                          
        }
        else {
            window.addEventListener('resize', resizeCanvas, false);
            
            $(window).keydown(function(e){
                //alert("hi");
                switch(e.which) {
                        case 37: left = true; 
                        break;

                        case 32: if (!jumped) {up = true; jumped = true;} else{up=false;}
                        break;

                        case 39: right = true;
                        break;

                        case 40: down = true;
                        break;

                        default: return;

                }
                e.preventDefault();
            });

            $(window).keyup(function(e){
                switch(e.which) {
                        case 37: left = false; 
                        break;

                        case 32: up = false; jumped = false;
                        break;

                        case 39: right = false;
                        break;

                        case 40: down = false;
                        break;

                        default: return;
                }
            });
        }
        
        function resizeCanvas(){
            canvas.canvas.width = window.innerWidth;
            canvas.canvas.height = window.innerHeight;
            myChar.w = canvas.canvas.height*0.10;
            myChar.h = canvas.canvas.height*0.10;
            myChar.x = canvas.canvas.width/7;
        }
        
        function Sprite(x,y,w,h,img_src) {
            this.img = new Image(); 
            this.img.src = img_src;
            this.x = x;
            this.y = y;
            this.w = w;
            this.h = h;
            this.draw = function(){
                canvas.drawImage(this.img, this.x,this.y,this.w,this.h);
            };
        }
            
        function Character(x,y,w,h,img_src) {
            var t = 0;
            Sprite.call(this,x,y,w,h,img_src);
            this.yVel = 0;
            this.move = function(){
                if (up) {
                    this.yVel=10; 
                    this.y-=10;
                   
                }
                //if (down) {t=0; this.y+=1;}
                //if (left) {t=0; this.x--}
                //if (right) {t=0; this.x++}
                if (!up) {
                        this.y -= this.yVel; 
                        this.yVel-=1;
                } 
                if (this.y - this.yVel<= 0){
                        this.y = 0;
                }
                if (this.y + this.h - this.yVel >= canvas.canvas.height){
                    this.y = canvas.canvas.height - this.h;
                }
                    
                else if (this.y <= 0){
                    this.y = 0;
                }
            };
        }
        
        Character.prototype = Object.create(Sprite.prototype);
        
        var myChar = new Character(canvas.canvas.width/7,10,charSize,charSize,"potato2/sprite_1.png");
        
        //found supposedly more efficient way to animate on internet
        window.requestAnimFrame = (function(){
            return window.requestAnimationFrame||
            window.webkitRequestAnimationFrame ||
            window.mozRequestAnimationFrame    ||
            window.oRequestAnimationFrame      || 
            window.msRequestAnimationFrame     || 
            function(callback){
                window.setTimeout(callback, 1000 / 60);
            };
        })();
        
        (function animloop(){
            requestAnimFrame(animloop);
            update();
            draw();
        })();
        
        function update(){
            textX += 1;
            textY += 1;
            myChar.move();
        }
       
        
        function draw(){
            canvas.clearRect(0,0,canvas.canvas.width,canvas.canvas.height);
            canvas.fillStyle = "#000"; // Set color to black
            canvas.font = "30px Arial";
            canvas.fillText("Sup!", textX, textY);
            myChar.draw();
        }
        
    </script>
    
</body>
    
</html>